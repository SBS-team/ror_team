$('body').append("<%= escape_javascript(render('shared/live_chat')) %>");

$("#new_live_chat").validate({
    rules: {
        "live_chat[guest_name]": {
            required: true,
            maxlength: 150,
            minlength: 2
        },
        "message": {
            required: true,
            maxlength: 255,
            minlength: 2
        },
        "recaptcha_response_field": {
            required: true
        }
    },
    messages: {
        "recaptcha_response_field": {
            required: "Captcha is required"
        }
    },
    errorPlacement: function(error, element) {
        if(element.attr('name') == 'recaptcha_response_field') {
            error.insertAfter('#recaptcha-div #dynamic_recaptcha #recaptcha_area')
        }
        else {
            error.insertAfter(element)
        }
    }
});

$("#new_message").validate({
    rules: {
        "message[name]": {
            required: true,
            maxlength: 30,
            minlength: 2
        },
        "message[email]": {
            required: true,
            email: true
        },
        "recaptcha_response_field": {
            required: true
        }
    },
    messages: {
        "recaptcha_response_field": {
            required: "Captcha is required"
        }
    },
    errorPlacement: function(error, element) {
        if(element.attr('name') == 'recaptcha_response_field') {
            error.insertAfter('#recaptcha-div #dynamic_recaptcha #recaptcha_area')
        }
        else {
            error.insertAfter(element)
        }
    }
});


$("#live_chat").draggable({
    handle: "#chat_handle",
    containment: "parent"
});

if ($.cookie('nickname')) {
    $("#live_chat_guest_name").val($.cookie('nickname'));
}